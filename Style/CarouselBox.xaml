<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:l="http://wpflocalizeextension.codeplex.com"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:i="clr-namespace:Ion.Controls"
    xmlns:Data="clr-namespace:Ion.Data">
    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="{i:Style Key=ListBox}"/>
    </ResourceDictionary.MergedDictionaries>
    <Style x:Key="{x:Type i:CarouselBox}" TargetType="{x:Type i:CarouselBox}" BasedOn="{StaticResource {x:Type ListBox}}">
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="ItemContainerStyle">
            <Setter.Value>
                <Style TargetType="{x:Type ListBoxItem}" BasedOn="{StaticResource {x:Type ListBoxItem}}">
                    <Setter Property="Visibility" Value="{i:CarouselVisibilityBinding}"/>
                </Style>
            </Setter.Value>
        </Setter>
        <Setter Property="ItemTemplate">
            <Setter.Value>
                <DataTemplate>
                    <TextBlock Text="{i:Bind}"/>
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="LeftButtonTemplate">
            <Setter.Value>
                <DataTemplate>
                    <i:ImageButton
                        Command="{i:Bind}"
                        Margin="0,0,10,0"
                        Source="{i:Image Key=ArrowLeft, Size=Large}"
                        SourceSize="72,48"
                        ToolTip="{i:Text Previous}"/>
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="Padding" Value="5"/>
        <Setter Property="RightButtonTemplate">
            <Setter.Value>
                <DataTemplate>
                    <i:ImageButton
                        Command="{i:Bind}"
                        Margin="10,0,0,0"
                        Source="{i:Image Key=ArrowRight, Size=Large}"
                        SourceSize="72,48"
                        ToolTip="{i:Text Next}"/>
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Auto"/>
        <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Hidden"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="i:CarouselBox">
                    <Border
                        Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        CornerRadius="{TemplateBinding Border.CornerRadius}">
                        <Grid i:XGrid.AutoColumns="True" i:XGrid.Columns="Auto,*,Auto">
                            <ContentPresenter
                                Content="{i:Bind From=TemplatedParent, Path=PreviousCommand}"
                                ContentTemplate="{TemplateBinding LeftButtonTemplate}"/>

                            <ScrollViewer>
                                <Grid>
                                    <i:DisplayEmpty/>
                                    <i:DisplaySelection/>
                                    <ItemsPresenter
                                        HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                        Margin="{TemplateBinding Padding}"
                                        VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                                </Grid>
                            </ScrollViewer>

                            <ContentPresenter Content="{i:Bind From=TemplatedParent, Path=NextCommand}"
                                ContentTemplate="{TemplateBinding RightButtonTemplate}"/>
                        </Grid>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsGrouping" Value="True">
                            <Setter Property="ScrollViewer.CanContentScroll" Value="False"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <UniformGrid>
                        <UniformGrid.Columns>
                            <Data:MultiBind Converter="{x:Static i:CarouselBox.ColumnConverter}">
                                <i:Bind From="FindAncestor" FromType="i:CarouselBox" Path="Columns"/>
                                <i:Bind From="FindAncestor" FromType="i:CarouselBox" Path="ItemsSource.Count"/>
                            </Data:MultiBind>
                        </UniformGrid.Columns>
                    </UniformGrid>
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>